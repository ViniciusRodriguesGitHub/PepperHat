<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Teste - Posicionamento do Player em Casas</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #2c3e50;
      color: white;
      font-family: Arial, sans-serif;
    }
    .test-info {
      background: #34495e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .test-button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #2980b9;
    }
    .test-button.success {
      background: #27ae60;
    }
    .test-button.warning {
      background: #f39c12;
    }
    #gameContainer {
      border: 2px solid #34495e;
      border-radius: 8px;
      display: inline-block;
    }
    .instructions {
      background: #34495e;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="test-info">
    <h2>üè† Teste de Posicionamento do Player em Casas</h2>
    <p><strong>Problema:</strong> Player aparece acima ou abaixo do piso dentro das casas em diferentes tamanhos de tela.</p>
    <p><strong>Solu√ß√£o:</strong> Usar posi√ß√£o fixa do piso da casa (GAME_HEIGHT / 2) em vez do groundY do mundo exterior.</p>
  </div>

  <div class="instructions">
    <h3>üìã Instru√ß√µes de Teste:</h3>
    <ol>
      <li>Inicie o jogo e entre em uma casa (agache-se perto de uma porta)</li>
      <li>Redimensione a janela e verifique se o player permanece no piso</li>
      <li>Use os bot√µes de teste para verificar o posicionamento</li>
    </ol>
  </div>

  <div>
    <button class="test-button" onclick="testHouseFloor()">Verificar Piso da Casa</button>
    <button class="test-button" onclick="testPlayerPosition()">Verificar Posi√ß√£o do Player</button>
    <button class="test-button" onclick="testResize()">Testar Redimensionamento</button>
    <button class="test-button" onclick="enterHouse()">Entrar em Casa (Simulado)</button>
    <button class="test-button" onclick="exitHouse()">Sair da Casa (Simulado)</button>
  </div>

  <div id="gameContainer"></div>

  <div id="testResults" style="margin-top: 20px; background: #34495e; padding: 15px; border-radius: 8px;">
    <h3>Resultados do Teste:</h3>
    <div id="testOutput"></div>
  </div>

  <script src="js/game.js"></script>
  <script>
    let testResults = [];

    function logTest(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
      testResults.push(`[${timestamp}] ${icon} ${message}`);
      document.getElementById('testOutput').innerHTML = testResults.join('<br>');
      console.log(`[TEST] ${message}`);
    }

    function testHouseFloor() {
      logTest('üîç Verificando piso da casa...');
      
      const houseFloorY = GAME_HEIGHT / 2;
      logTest(`Piso da casa calculado: ${houseFloorY}px`);
      logTest(`GAME_HEIGHT: ${GAME_HEIGHT}px`);
      logTest(`Canvas height: ${canvas.height}px`);
      
      if (typeof window.houseFloorY !== 'undefined') {
        logTest(`House floor Y global: ${window.houseFloorY}px`);
      } else {
        logTest('‚ö†Ô∏è House floor Y global n√£o definido', 'warning');
      }
      
      // Verificar se o piso est√° no meio da tela
      const expectedFloorY = GAME_HEIGHT / 2;
      if (Math.abs(houseFloorY - expectedFloorY) < 1) {
        logTest('‚úÖ Piso da casa posicionado corretamente no meio da tela', 'success');
      } else {
        logTest(`‚ùå Piso da casa n√£o est√° no meio: esperado ${expectedFloorY}, atual ${houseFloorY}`, 'error');
      }
    }

    function testPlayerPosition() {
      logTest('üîç Verificando posi√ß√£o do player...');
      
      if (typeof player !== 'undefined') {
        logTest(`Player Y: ${player.y.toFixed(2)}px`);
        logTest(`Player height: ${player.height}px`);
        logTest(`Player bottom: ${(player.y + player.height).toFixed(2)}px`);
        
        if (typeof isInHouse !== 'undefined' && isInHouse) {
          const houseFloorY = GAME_HEIGHT / 2;
          const playerBottom = player.y + player.height;
          const tolerance = 5; // 5px de toler√¢ncia
          
          if (Math.abs(playerBottom - houseFloorY) <= tolerance) {
            logTest('‚úÖ Player posicionado corretamente no piso da casa', 'success');
          } else {
            logTest(`‚ùå Player n√£o est√° no piso: player bottom ${playerBottom.toFixed(2)}, floor ${houseFloorY}`, 'error');
          }
        } else {
          logTest('‚ÑπÔ∏è Player n√£o est√° dentro de uma casa');
        }
      } else {
        logTest('‚ùå Player n√£o definido', 'error');
      }
    }

    function testResize() {
      logTest('üîÑ Testando redimensionamento...');
      
      const originalWidth = window.innerWidth;
      const originalHeight = window.innerHeight;
      
      // Redimensionar para diferentes tamanhos
      const testSizes = [
        { width: 1200, height: 800 },
        { width: 800, height: 600 },
        { width: 1024, height: 768 }
      ];
      
      let currentTest = 0;
      
      function runNextTest() {
        if (currentTest < testSizes.length) {
          const size = testSizes[currentTest];
          logTest(`üìè Testando tamanho: ${size.width}x${size.height}`);
          
          window.resizeTo(size.width, size.height);
          
          setTimeout(() => {
            if (typeof isInHouse !== 'undefined' && isInHouse) {
              const houseFloorY = GAME_HEIGHT / 2;
              const playerBottom = player.y + player.height;
              
              if (Math.abs(playerBottom - houseFloorY) <= 5) {
                logTest(`‚úÖ Player posicionado corretamente em ${size.width}x${size.height}`, 'success');
              } else {
                logTest(`‚ùå Player mal posicionado em ${size.width}x${size.height}`, 'error');
              }
            }
            
            currentTest++;
            setTimeout(runNextTest, 500);
          }, 100);
        } else {
          // Restaurar tamanho original
          window.resizeTo(originalWidth, originalHeight);
          logTest('üîÑ Tamanho original restaurado');
        }
      }
      
      runNextTest();
    }

    function enterHouse() {
      logTest('üö™ Simulando entrada em casa...');
      
      if (typeof isInHouse !== 'undefined') {
        // Simular entrada em casa
        isInHouse = true;
        player.x = GAME_WIDTH / 2;
        player.y = GAME_HEIGHT / 2 - player.initialHeight;
        
        logTest('‚úÖ Player posicionado dentro da casa');
        testPlayerPosition();
      } else {
        logTest('‚ùå Vari√°veis do jogo n√£o dispon√≠veis', 'error');
      }
    }

    function exitHouse() {
      logTest('üö™ Simulando sa√≠da da casa...');
      
      if (typeof isInHouse !== 'undefined') {
        // Simular sa√≠da da casa
        isInHouse = false;
        player.y = groundY - player.initialHeight;
        
        logTest('‚úÖ Player posicionado fora da casa');
        testPlayerPosition();
      } else {
        logTest('‚ùå Vari√°veis do jogo n√£o dispon√≠veis', 'error');
      }
    }

    // Aguardar o jogo carregar
    window.addEventListener('load', () => {
      setTimeout(() => {
        logTest('üéÆ Jogo carregado - Pronto para testes de posicionamento em casas');
        testHouseFloor();
      }, 2000);
    });
  </script>
</body>
</html>
